# Password Validation

## Overview and motivation
Currently, `ms-users` service allows any passwords in the user registration request. But this brings some user-side security vulnerabilities.

General policies describe that password should:
 - Minimum length starts from 8 chars
 - Contain different character cases
 - Contain some digits
 - Shouldn't have many repeating characters
 - Shouldn't be in common passwords list

Additional password validation should be added to provide better security for users.

## General
A possible solution is to use existing password-strength checking solution like `dropbox/zxcvbn` - provides password strength check using predefined dictionaries and pattern matching. With password ~25 char length, projected latency is ~5-25ms. In the future, we can extend included dictionaries according to our needs.

## Note
Enabling password validator is Breaking change and disabled by default.
In the nearest future, when everything will be ready, a validator must be enabled.

## OTP and Empty Password
The `password` field is not defined as `required` in current `schemas`.
Validation is not performed because this field does not exist in the OTP registration request.
When the Service performs password generation, `skipPassword` property does not exist in the registration request, so validator does not check these generated passwords.

**NOTE:** Added additional test suites just to be sure.

## Validator Keyword
Service validation algorithm based on the AJV validator and all validation requirements are inside schemas. All incoming requests checked. We can add additional custom validator `password` keyword for the `password` field, which performs required checks.

Current schema:

```json
{
  "$id": "register",
  "type": "object",
    "password": {
      "type": "string"
    }
}
```

After keyword added:
```json
{
  "$id": "register",
  "type": "object",
  "password": {
    "type": "string",
    "password": true
   }
}
```

## `password`
The parameter accepts the required strength in the range [0-4] that describes the required password complexity.

According to the registration process, some passwords generated by service, so custom validator should omit password check if `skipPassword` request param provided.

When executed:
- checks username does not match provided password
- calls `zxcvbn` to obtain a complexity of passwords and returns whether the given password matches policy

Also, we can pass user-provided data into `zxcvbn` to check whether some sensitive data used in the password.

### Sample config
`skipCheckFieldName` - Allows skipping password check if any field exists.
`forceCheckFieldName` - Allows forcing password check if any field exists.
`inputFieldNames` - values point to parent object fields that passed into `zxcvbn`.

`enabled` - disable/enable validator. Default value is false.
```js
const config = {
  enabled: false,
  minStrength: 3, // Desired strength
  skipCheckFieldNames: ['skipPassword'], // Disables password check if the object field value exists.
  forceCheckFieldNames: ['checkPassword'], // Forces password check if the object field value exists.
  inputFieldNames: [ // Linked fields list, allows to filter the sensitive data in the password from the parent object.
    'username',
    'otherfield'
  ]
}
```
